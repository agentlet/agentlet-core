<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Export - Agentlet Core Example</title>
    <link rel="icon" type="image/x-icon" href="../../../resources/favicons/favicon.ico">
    <link rel="stylesheet" href="../../shared/examples.css">
    <link rel="stylesheet" href="../../shared/two-column-layout.css">
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="two-column-container">
            <!-- Left Column: Content and Controls -->
            <div class="left-column">
                <div class="nav-breadcrumb">
                    <a href="../../">Examples</a> ‚Üí <a href="../">04-tables</a> ‚Üí export ‚Üí excel-export
                </div>

                <h1>üì• Excel Export - Agentlet Core</h1>
                
                <p>This example demonstrates advanced Excel export capabilities using Agentlet Core's table utilities with SheetJS integration.</p>

                <div class="example-section">
                    <h3>What this example shows:</h3>
                    <ul>
                        <li>Single and multiple sheet Excel exports</li>
                        <li>Custom formatting and styling options</li>
                        <li>Metadata inclusion and data validation</li>
                        <li>Extract and download in one operation</li>
                        <li>Professional workbook creation with multiple sheets</li>
                    </ul>
                </div>

        <!-- Sample Tables for Export Testing -->
        <div class="example-section">
            <h3>Sample Data Tables</h3>
            
            <table id="sales-data" class="export-table">
                <caption>Q4 2023 Sales Data</caption>
                <thead>
                    <tr>
                        <th>Region</th>
                        <th>Salesperson</th>
                        <th>Product</th>
                        <th>Units Sold</th>
                        <th>Revenue</th>
                        <th>Commission</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>North</td>
                        <td>Alice Johnson</td>
                        <td>MacBook Pro</td>
                        <td>12</td>
                        <td>$28,788</td>
                        <td>$2,879</td>
                        <td>2023-10-15</td>
                    </tr>
                    <tr>
                        <td>South</td>
                        <td>Bob Wilson</td>
                        <td>iPhone 15</td>
                        <td>25</td>
                        <td>$24,975</td>
                        <td>$2,498</td>
                        <td>2023-10-18</td>
                    </tr>
                    <tr>
                        <td>East</td>
                        <td>Carol Davis</td>
                        <td>iPad Air</td>
                        <td>18</td>
                        <td>$10,782</td>
                        <td>$1,078</td>
                        <td>2023-11-02</td>
                    </tr>
                    <tr>
                        <td>West</td>
                        <td>David Miller</td>
                        <td>Apple Watch</td>
                        <td>30</td>
                        <td>$11,970</td>
                        <td>$1,197</td>
                        <td>2023-11-12</td>
                    </tr>
                    <tr>
                        <td>North</td>
                        <td>Emma Brown</td>
                        <td>MacBook Air</td>
                        <td>8</td>
                        <td>$7,992</td>
                        <td>$799</td>
                        <td>2023-12-05</td>
                    </tr>
                </tbody>
            </table>

            <table id="customer-data" class="export-table">
                <caption>Customer Information</caption>
                <thead>
                    <tr>
                        <th>Customer ID</th>
                        <th>Company</th>
                        <th>Contact Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>City</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>CUST001</td>
                        <td>Acme Corp</td>
                        <td>John Smith</td>
                        <td>john@acme.com</td>
                        <td>+1-555-0101</td>
                        <td>New York</td>
                        <td>Active</td>
                    </tr>
                    <tr>
                        <td>CUST002</td>
                        <td>TechStart Inc</td>
                        <td>Sarah Jones</td>
                        <td>sarah@techstart.com</td>
                        <td>+1-555-0102</td>
                        <td>San Francisco</td>
                        <td>Active</td>
                    </tr>
                    <tr>
                        <td>CUST003</td>
                        <td>Global Solutions</td>
                        <td>Mike Chen</td>
                        <td>mike@global.com</td>
                        <td>+1-555-0103</td>
                        <td>Chicago</td>
                        <td>Pending</td>
                    </tr>
                    <tr>
                        <td>CUST004</td>
                        <td>Innovation Labs</td>
                        <td>Lisa Taylor</td>
                        <td>lisa@innovation.com</td>
                        <td>+1-555-0104</td>
                        <td>Austin</td>
                        <td>Active</td>
                    </tr>
                </tbody>
            </table>

            <table id="financial-summary" class="export-table">
                <caption>Financial Summary</caption>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Q1 2023</th>
                        <th>Q2 2023</th>
                        <th>Q3 2023</th>
                        <th>Q4 2023</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Revenue</td>
                        <td>$125,000</td>
                        <td>$142,000</td>
                        <td>$158,000</td>
                        <td>$176,000</td>
                        <td>$601,000</td>
                    </tr>
                    <tr>
                        <td>Expenses</td>
                        <td>$85,000</td>
                        <td>$95,000</td>
                        <td>$108,000</td>
                        <td>$118,000</td>
                        <td>$406,000</td>
                    </tr>
                    <tr>
                        <td>Profit</td>
                        <td>$40,000</td>
                        <td>$47,000</td>
                        <td>$50,000</td>
                        <td>$58,000</td>
                        <td>$195,000</td>
                    </tr>
                </tbody>
            </table>
        </div>

                <div class="controls">
                    <h4>üöÄ Initialize</h4>
                    <button onclick="initAgentlet()" id="initBtn">Initialize Agentlet Core</button>
                    <button onclick="checkStatus()">Check Status</button>
                </div>

                <div class="controls">
                    <h4>üìä Single Table Export</h4>
                    <button onclick="exportSalesData()" id="salesBtn">üìä Export Sales Data</button>
                    <button onclick="exportCustomerData()" id="customerBtn">üë• Export Customer Data</button>
                    <button onclick="exportFinancialSummary()" id="financialBtn">üí∞ Export Financial Summary</button>
                </div>

                <div class="controls">
                    <h4>üìö Multi-Sheet Export</h4>
                    <button onclick="exportAllAsWorkbook()" id="workbookBtn">üìö Export All as Workbook</button>
                    <button onclick="exportWithCustomSheetNames()" id="customBtn">üìù Custom Sheet Names</button>
                    <button onclick="exportWithFormatting()" id="formatBtn">üé® Export with Formatting</button>
                </div>

                <div class="controls">
                    <h4>üîß Advanced Export Options</h4>
                    <button onclick="exportWithMetadata()" id="metadataBtn">üìã Export with Metadata</button>
                    <button onclick="exportLargeDataset()" id="largeBtn">üìà Export Large Dataset</button>
                    <button onclick="extractAndExportDemo()" id="extractBtn">‚ö° Extract & Export Demo</button>
                </div>

                <div class="example-section">
                    <h3>üìú Excel Export API Reference:</h3>
                    <div class="code-block">
                        <h4>Basic Export</h4>
                        <pre><code class="language-javascript">// Single table export
const tableData = window.agentlet.tables.extract(tableElement);
const result = window.agentlet.tables.download(tableData, {
    filename: 'data.xlsx',
    sheetName: 'Sheet1'
});

// Extract and download in one step
const result = await window.agentlet.tables.extractAndDownload(tableElement, {
    filename: 'table-data.xlsx'
});</code></pre>
                        
                        <h4>Multi-Sheet Workbook</h4>
                        <pre><code class="language-javascript">// Multiple tables as separate sheets
const workbookData = [
    { name: 'Sales', data: salesTableData },
    { name: 'Customers', data: customerTableData },
    { name: 'Summary', data: summaryTableData }
];

const result = window.agentlet.tables.download(workbookData, {
    filename: 'business-report.xlsx',
    includeMetadata: true
});</code></pre>
                        
                        <h4>Advanced Formatting</h4>
                        <pre><code class="language-javascript">// Export with custom formatting
const result = window.agentlet.tables.download(tableData, {
    filename: 'formatted-data.xlsx',
    formatting: {
        headerStyle: {
            background: '#4CAF50',
            color: 'white',
            bold: true
        },
        dataStyle: {
            fontSize: 11,
            border: true
        }
    }
});</code></pre>
                    </div>
                </div>
            </div>

            <!-- Right Column: Console and Status -->
            <div class="right-column">
                <div class="console-header">
                    <h3>üìü Console Output</h3>
                    <button onclick="clearConsole()" class="console-clear-btn">üóëÔ∏è Clear</button>
                </div>
                <div class="console-section" id="console"></div>
                
                <h3>üìä Status</h3>
                <div class="status-section" id="status">
                    Click "Initialize Agentlet Core" to start the demo.
                </div>
                
                
                <h3>üì• Export Activity</h3>
                <div class="stats-section" id="exportStats">
                    <div>Tables API available: <span id="tablesAvailable">No</span></div>
                    <div>Files exported: <span id="filesExported">0</span></div>
                    <div>Tables exported: <span id="tablesExported">0</span></div>
                    <div>Last export type: <span id="lastExportType">None</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Console utilities -->
    <script src="../../shared/console-utils.js"></script>

    <style>
        .export-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 13px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .export-table caption {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #495057;
            padding: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-bottom: none;
        }
        
        .export-table th {
            background: #28a745;
            color: white;
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #1e7e34;
            font-size: 12px;
        }
        
        .export-table td {
            padding: 8px;
            border-bottom: 1px solid #dee2e6;
            font-size: 12px;
        }
        
        .export-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .export-table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        /* Export progress indication */
        .exporting-table {
            outline: 3px solid #ffc107;
            outline-offset: 2px;
            background: rgba(255, 193, 7, 0.1);
        }
        
        .exported-table {
            outline: 3px solid #28a745;
            outline-offset: 2px;
            background: rgba(40, 167, 69, 0.1);
        }
    </style>

    <script>
        let filesExported = 0;
        let tablesExported = 0;
        let lastExportType = 'None';
        
        // Configure Agentlet
        window.agentletConfig = {
            debugMode: true,
            theme: 'default',
            startMinimized: true  // Start with panel minimized
        };

        // Update export stats display
        function updateExportStats() {
            const elements = {
                tablesAvailable: document.getElementById('tablesAvailable'),
                filesExported: document.getElementById('filesExported'),
                tablesExported: document.getElementById('tablesExported'),
                lastExportType: document.getElementById('lastExportType')
            };

            if (elements.tablesAvailable) {
                const available = !!(window.agentlet && window.agentlet.tables);
                elements.tablesAvailable.textContent = available ? 'Yes' : 'No';
            }
            
            if (elements.filesExported) {
                elements.filesExported.textContent = filesExported;
            }
            
            if (elements.tablesExported) {
                elements.tablesExported.textContent = tablesExported;
            }
            
            if (elements.lastExportType) {
                elements.lastExportType.textContent = lastExportType;
            }
        }

        function trackExport(type, fileCount = 1, tableCount = 1) {
            filesExported += fileCount;
            tablesExported += tableCount;
            lastExportType = type;
            updateExportStats();
            log(`üì• ${type} export completed`, 'success');
        }

        function checkStatus() {
            log('üîç Checking Agentlet and tables status...');
            
            if (window.agentlet && window.agentlet.tables) {
                log('‚úÖ Tables API is available', 'success');
                log(`üìä Available methods: ${Object.keys(window.agentlet.tables).join(', ')}`);\
                log(`üì• Export methods available: download, extractAndDownload`);\
                updateStatus('Tables API ready for Excel export!', 'success');
            } else if (window.agentlet) {
                log('‚ö†Ô∏è Agentlet loaded but tables API not found', 'warning');
                updateStatus('Agentlet loaded but tables API not available', 'warning');
            } else {
                log('‚ùå Agentlet not initialized yet', 'warning');
                updateStatus('Please initialize Agentlet Core first', 'warning');
            }
            
            updateExportStats();
        }

        async function initAgentlet() {
            try {
                setButtonLoading('initBtn', true);
                updateStatus('Loading Agentlet Core...', 'info');
                log('ü§ñ Initializing Agentlet Core...');

                if (window.agentlet) {
                    log('‚ö†Ô∏è Agentlet already loaded', 'warning');
                    updateStatus('Ready! Try the export buttons above.', 'success');
                    setButtonLoading('initBtn', false);
                    updateExportStats();
                    return;
                }

                // Simulate loading delay for demonstration
                await new Promise(resolve => setTimeout(resolve, 500));

                const script = document.createElement('script');
                script.src = '../../../dist/agentlet-core.js?' + Date.now();
                
                script.onload = () => {
                    log('‚úÖ Agentlet Core script loaded successfully', 'success');
                    
                    let AgentletConstructor = null;
                    if (window.AgentletCore) {
                        AgentletConstructor = window.AgentletCore.default;
                    }
                    
                    if (AgentletConstructor) {
                        try {
                            log('üöÄ Creating AgentletCore instance...');
                            const agentletInstance = new AgentletConstructor(window.agentletConfig);
                                
                            log('‚öôÔ∏è Starting initialization...');
                            agentletInstance.init().then(() => {
                                if (window.agentlet && window.agentlet.tables) {
                                    log('‚úÖ Agentlet Core loaded with Table utilities', 'success');
                                    log(`üìä Available table methods: ${Object.keys(window.agentlet.tables).join(', ')}`);\
                                    log('üì• Excel export capabilities ready with SheetJS integration');
                                    updateStatus('Ready! Try the Excel export buttons above.', 'success');
                                } else {
                                    log('‚ùå Table utilities not available', 'error');
                                    updateStatus('Table utilities not available', 'error');
                                }
                                updateExportStats();
                                setButtonLoading('initBtn', false);
                            }).catch(error => {
                                log(`‚ùå Initialization failed: ${error.message}`, 'error');
                                updateStatus('Initialization failed: ' + error.message, 'error');
                                setButtonLoading('initBtn', false);
                            });
                                
                        } catch (error) {
                            log(`‚ùå Error creating AgentletCore instance: ${error.message}`, 'error');
                            updateStatus('Error creating instance: ' + error.message, 'error');
                            setButtonLoading('initBtn', false);
                        }
                    } else {
                        log('‚ùå AgentletCore constructor not available', 'error');
                        updateStatus('AgentletCore constructor not found', 'error');
                        setButtonLoading('initBtn', false);
                    }
                };

                script.onerror = () => {
                    log('‚ùå Failed to load Agentlet Core script', 'error');
                    updateStatus('Failed to load Agentlet Core. Make sure you ran "npm run build" first.', 'error');
                    setButtonLoading('initBtn', false);
                };

                document.head.appendChild(script);

            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                updateStatus('Initialization error: ' + error.message, 'error');
                setButtonLoading('initBtn', false);
            }
        }

        function checkTables() {
            if (!window.agentlet || !window.agentlet.tables) {
                updateStatus('Table utilities not available. Initialize Agentlet first.', 'warning');
                return false;
            }
            return true;
        }

        function exportSalesData() {
            if (!checkTables()) return;

            try {
                setButtonLoading('salesBtn', true);
                const salesTable = document.getElementById('sales-data');
                highlightExporting(salesTable);
                
                log('üìä Extracting sales data for export...');
                const tableData = window.agentlet.tables.extract(salesTable);
                
                log(`üìä Sales table extracted: ${tableData.rows.length} rows, ${tableData.headers.length} columns`);
                log(`üìä Headers: ${tableData.headers.join(', ')}`);
                
                const result = window.agentlet.tables.download(tableData, {
                    filename: 'q4-2023-sales-data.xlsx',
                    sheetName: 'Sales Data',
                    includeMetadata: true
                });
                
                log('üì• Sales data Excel export completed:');
                log(`   File: ${result.filename || 'q4-2023-sales-data.xlsx'}`);
                log(`   Data rows: ${tableData.rows.length}`);
                log(`   Total revenue: ${tableData.rows.reduce((sum, row) => sum + parseFloat(row.Revenue?.replace(/[$,]/g, '') || 0), 0).toLocaleString('en-US', { style: 'currency', currency: 'USD' })}`);
                
                highlightExported(salesTable);
                trackExport('Sales Data', 1, 1);
                updateStatus(`Sales data exported: ${tableData.rows.length} records`, 'success');
                setTimeout(() => setButtonLoading('salesBtn', false), 300);
            } catch (error) {
                log(`‚ùå Error exporting sales data: ${error.message}`, 'error');
                updateStatus('Sales export failed', 'error');
                setButtonLoading('salesBtn', false);
            }
        }

        function exportCustomerData() {
            if (!checkTables()) return;

            try {
                setButtonLoading('customerBtn', true);
                const customerTable = document.getElementById('customer-data');
                highlightExporting(customerTable);
                
                log('üë• Extracting customer data for export...');
                const tableData = window.agentlet.tables.extract(customerTable);
                
                log(`üë• Customer table extracted: ${tableData.rows.length} customers`);
                log(`üë• Active customers: ${tableData.rows.filter(row => row.Status === 'Active').length}`);
                
                const result = window.agentlet.tables.download(tableData, {
                    filename: 'customer-directory.xlsx',
                    sheetName: 'Customers',
                    includeMetadata: true
                });
                
                log('üì• Customer data Excel export completed:');
                log(`   File: ${result.filename || 'customer-directory.xlsx'}`);
                log(`   Customer records: ${tableData.rows.length}`);
                log(`   Cities represented: ${new Set(tableData.rows.map(row => row.City)).size}`);
                
                highlightExported(customerTable);
                trackExport('Customer Data', 1, 1);
                updateStatus(`Customer data exported: ${tableData.rows.length} customers`, 'success');
                setTimeout(() => setButtonLoading('customerBtn', false), 300);
            } catch (error) {
                log(`‚ùå Error exporting customer data: ${error.message}`, 'error');
                updateStatus('Customer export failed', 'error');
                setButtonLoading('customerBtn', false);
            }
        }

        function exportFinancialSummary() {
            if (!checkTables()) return;

            try {
                setButtonLoading('financialBtn', true);
                const financialTable = document.getElementById('financial-summary');
                highlightExporting(financialTable);
                
                log('üí∞ Extracting financial summary for export...');
                const tableData = window.agentlet.tables.extract(financialTable);
                
                log(`üí∞ Financial summary extracted: ${tableData.rows.length} categories`);
                const totalRow = tableData.rows.find(row => row.Category === 'Revenue');
                if (totalRow) {
                    log(`üí∞ Total revenue for 2023: ${totalRow.Total}`);
                }
                
                const result = window.agentlet.tables.download(tableData, {
                    filename: 'financial-summary-2023.xlsx',
                    sheetName: 'Financial Summary',
                    includeMetadata: true
                });
                
                log('üì• Financial summary Excel export completed:');
                log(`   File: ${result.filename || 'financial-summary-2023.xlsx'}`);
                log(`   Financial categories: ${tableData.rows.length}`);
                log(`   Quarters covered: Q1-Q4 2023`);
                
                highlightExported(financialTable);
                trackExport('Financial Summary', 1, 1);
                updateStatus(`Financial summary exported: ${tableData.rows.length} categories`, 'success');
                setTimeout(() => setButtonLoading('financialBtn', false), 300);
            } catch (error) {
                log(`‚ùå Error exporting financial summary: ${error.message}`, 'error');
                updateStatus('Financial export failed', 'error');
                setButtonLoading('financialBtn', false);
            }
        }

        function exportAllAsWorkbook() {
            if (!checkTables()) return;

            try {
                setButtonLoading('workbookBtn', true);
                const tables = document.querySelectorAll('.export-table');
                log('üìö Creating multi-sheet workbook from all tables...');
                
                const workbookData = [];
                let totalRows = 0;
                
                tables.forEach((table, index) => {
                    highlightExporting(table);
                    const tableData = window.agentlet.tables.extract(table);
                    const sheetName = table.caption?.textContent || `Sheet ${index + 1}`;
                    
                    workbookData.push({
                        name: sheetName,
                        data: tableData
                    });
                    
                    totalRows += tableData.rows.length;
                    log(`   Sheet "${sheetName}": ${tableData.rows.length} rows, ${tableData.headers.length} columns`);
                });
                
                const result = window.agentlet.tables.download(workbookData, {
                    filename: 'business-data-workbook.xlsx',
                    includeMetadata: true
                });
                
                tables.forEach(table => highlightExported(table));
                
                log('üìö Multi-sheet workbook created successfully:');
                log(`   File: ${result.filename || 'business-data-workbook.xlsx'}`);
                log(`   Total sheets: ${workbookData.length}`);
                log(`   Total data rows: ${totalRows}`);
                
                trackExport('Multi-Sheet Workbook', 1, workbookData.length);
                updateStatus(`Workbook exported: ${workbookData.length} sheets, ${totalRows} total rows`, 'success');
                setTimeout(() => setButtonLoading('workbookBtn', false), 300);
            } catch (error) {
                log(`‚ùå Error creating workbook: ${error.message}`, 'error');
                updateStatus('Workbook export failed', 'error');
                setButtonLoading('workbookBtn', false);
            }
        }

        function exportWithCustomSheetNames() {
            if (!checkTables()) return;

            try {
                setButtonLoading('customBtn', true);
                log('üìù Creating workbook with custom sheet names...');
                
                const salesTable = document.getElementById('sales-data');
                const customerTable = document.getElementById('customer-data');
                
                const salesData = window.agentlet.tables.extract(salesTable);
                const customerData = window.agentlet.tables.extract(customerTable);
                
                const workbookData = [
                    {
                        name: 'Q4_Sales_Report',
                        data: salesData
                    },
                    {
                        name: 'Customer_Database',
                        data: customerData
                    }
                ];
                
                log('üìù Processing sheets with custom names:');
                workbookData.forEach(sheet => {
                    log(`   Sheet: "${sheet.name}" - ${sheet.data.rows.length} rows`);
                });
                
                const result = window.agentlet.tables.download(workbookData, {
                    filename: 'custom-named-sheets.xlsx',
                    includeMetadata: true
                });
                
                log('üì• Custom sheet names export completed:');
                log(`   File: ${result.filename || 'custom-named-sheets.xlsx'}`);
                log(`   Professional sheet naming applied`);
                
                trackExport('Custom Sheet Names', 1, 2);
                updateStatus('Custom named sheets exported successfully', 'success');
                setTimeout(() => setButtonLoading('customBtn', false), 300);
            } catch (error) {
                log(`‚ùå Error with custom sheet names: ${error.message}`, 'error');
                updateStatus('Custom export failed', 'error');
                setButtonLoading('customBtn', false);
            }
        }

        function exportWithFormatting() {
            if (!checkTables()) return;

            try {
                setButtonLoading('formatBtn', true);
                log('üé® Applying advanced formatting to export...');
                
                const salesTable = document.getElementById('sales-data');
                highlightExporting(salesTable);
                
                const tableData = window.agentlet.tables.extract(salesTable);
                
                const result = window.agentlet.tables.download(tableData, {
                    filename: 'formatted-sales-data.xlsx',
                    sheetName: 'Sales Report',
                    includeMetadata: true,
                    formatting: {
                        headerStyle: {
                            background: '#28a745',
                            color: 'white',
                            bold: true
                        },
                        dataStyle: {
                            fontSize: 11,
                            border: true
                        }
                    }
                });
                
                log('üé® Advanced formatting applied:');
                log(`   Header style: Green background (#28a745), white text, bold`);
                log(`   Data style: 11px font size, borders enabled`);
                log(`   File: ${result.filename || 'formatted-sales-data.xlsx'}`);
                
                highlightExported(salesTable);
                trackExport('Formatted Export', 1, 1);
                updateStatus('Formatted export completed with styling', 'success');
                setTimeout(() => setButtonLoading('formatBtn', false), 300);
            } catch (error) {
                log(`‚ùå Error with formatting: ${error.message}`, 'error');
                updateStatus('Formatted export failed', 'error');
                setButtonLoading('formatBtn', false);
            }
        }

        function exportWithMetadata() {
            if (!checkTables()) return;

            try {
                setButtonLoading('metadataBtn', true);
                log('üìã Exporting with comprehensive metadata...');
                
                const salesTable = document.getElementById('sales-data');
                highlightExporting(salesTable);
                
                const tableData = window.agentlet.tables.extract(salesTable, {
                    includeMetadata: true,
                    includeStyles: true,
                    detectDataTypes: true
                });
                
                log('üìã Metadata extraction details:');
                log(`   Table dimensions: ${tableData.metadata?.dimensions || 'unknown'}`);
                log(`   Caption: ${tableData.metadata?.caption || 'none'}`);
                if (tableData.metadata?.dataTypes) {
                    log(`   Data types detected:`);
                    Object.entries(tableData.metadata.dataTypes).forEach(([column, type]) => {
                        log(`     ${column}: ${type}`);
                    });
                }
                
                const result = window.agentlet.tables.download(tableData, {
                    filename: 'sales-data-with-metadata.xlsx',
                    sheetName: 'Sales Data',
                    includeMetadata: true
                });
                
                log('üì• Metadata export completed:');
                log(`   File: ${result.filename || 'sales-data-with-metadata.xlsx'}`);
                log(`   Enhanced metadata included in export`);
                
                highlightExported(salesTable);
                trackExport('Metadata Export', 1, 1);
                updateStatus('Export with metadata completed', 'success');
                setTimeout(() => setButtonLoading('metadataBtn', false), 300);
            } catch (error) {
                log(`‚ùå Error exporting with metadata: ${error.message}`, 'error');
                updateStatus('Metadata export failed', 'error');
                setButtonLoading('metadataBtn', false);
            }
        }

        function exportLargeDataset() {
            if (!checkTables()) return;

            try {
                setButtonLoading('largeBtn', true);
                log('üìà Simulating large dataset export...');
                
                // Use all tables to simulate a larger dataset
                const tables = document.querySelectorAll('.export-table');
                const combinedData = { headers: [], rows: [] };
                let totalProcessed = 0;
                
                tables.forEach((table, index) => {
                    highlightExporting(table);
                    const tableData = window.agentlet.tables.extract(table);
                    
                    if (index === 0) {
                        combinedData.headers = ['Source', ...tableData.headers];
                    }
                    
                    tableData.rows.forEach(row => {
                        const extendedRow = { Source: table.caption?.textContent || `Table ${index + 1}`, ...row };
                        combinedData.rows.push(extendedRow);
                        totalProcessed++;
                    });
                    
                    log(`   Processed ${table.caption?.textContent || `Table ${index + 1}`}: ${tableData.rows.length} rows`);
                });
                
                log(`üìà Large dataset processing complete: ${totalProcessed} total rows`);
                
                const result = window.agentlet.tables.download(combinedData, {
                    filename: 'large-business-dataset.xlsx',
                    sheetName: 'Combined Data',
                    includeMetadata: true
                });
                
                tables.forEach(table => highlightExported(table));
                
                log('üì• Large dataset export completed:');
                log(`   File: ${result.filename || 'large-business-dataset.xlsx'}`);
                log(`   Combined rows: ${totalProcessed}`);
                log(`   Data sources: ${tables.length}`);
                
                trackExport('Large Dataset', 1, tables.length);
                updateStatus(`Large dataset exported: ${totalProcessed} rows from ${tables.length} sources`, 'success');
                setTimeout(() => setButtonLoading('largeBtn', false), 300);
            } catch (error) {
                log(`‚ùå Error exporting large dataset: ${error.message}`, 'error');
                updateStatus('Large dataset export failed', 'error');
                setButtonLoading('largeBtn', false);
            }
        }

        function extractAndExportDemo() {
            if (!checkTables()) return;

            try {
                setButtonLoading('extractBtn', true);
                log('‚ö° Demonstrating extract and export in one operation...');
                
                const customerTable = document.getElementById('customer-data');
                highlightExporting(customerTable);
                
                log('‚ö° Using extractAndDownload method...');
                
                window.agentlet.tables.extractAndDownload(customerTable, {
                    filename: 'one-step-customer-export.xlsx',
                    sheetName: 'Customer Data',
                    includeMetadata: true
                }).then(result => {
                    log('‚ö° One-step extract and export completed:');
                    log(`   File: ${result.filename || 'one-step-customer-export.xlsx'}`);
                    log(`   Operation: Extract + Export in single call`);
                    log(`   Efficiency: Streamlined workflow`);
                    
                    highlightExported(customerTable);
                    trackExport('Extract & Export', 1, 1);
                    updateStatus('One-step extract and export completed', 'success');
                    setTimeout(() => setButtonLoading('extractBtn', false), 300);
                }).catch(error => {
                    log(`‚ùå Error with extract and export: ${error.message}`, 'error');
                    updateStatus('Extract and export failed', 'error');
                    setButtonLoading('extractBtn', false);
                });
                
            } catch (error) {
                log(`‚ùå Error with extract and export demo: ${error.message}`, 'error');
                updateStatus('Extract and export demo failed', 'error');
                setButtonLoading('extractBtn', false);
            }
        }


        function highlightExporting(table) {
            table.classList.remove('exported-table');
            table.classList.add('exporting-table');
        }

        function highlightExported(table) {
            table.classList.remove('exporting-table');
            table.classList.add('exported-table');
            
            setTimeout(() => {
                table.classList.remove('exported-table');
            }, 3000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            log('üìÑ Excel export demo ready', 'success');
            updateStatus('Ready for Agentlet initialization', 'info');
            updateExportStats();
        });

        // Update export stats periodically
        setInterval(updateExportStats, 2000);
    </script>
</body>
</html>