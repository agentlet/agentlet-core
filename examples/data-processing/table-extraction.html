<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Table Extraction - Agentlet Core Example</title>
    <link rel="icon" type="image/x-icon" href="../../resources/favicons/favicon.ico">
    <link rel="stylesheet" href="../shared/examples.css">
    <link rel="stylesheet" href="../shared/two-column-layout.css">
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="two-column-container">
            <!-- Left Column: Content and Controls -->
            <div class="left-column">
                <div class="nav-breadcrumb">
                    <a href="../">Examples</a> → data-processing → table-extraction
                </div>

                <h1>Simple table extraction</h1>

                <p>This example demonstrates how to extract structured data from HTML tables using Agentlet Core.</p>

                <div class="example-section">
                    <h3>What this example shows</h3>
                    <ul>
                        <li>Basic table data extraction</li>
                        <li>Header detection and column mapping</li>
                        <li>Data type inference and formatting</li>
                        <li>Export to various formats (JSON, CSV, Excel)</li>
                    </ul>
                </div>

                <div class="controls">
                    <h4>Initialize</h4>
                    <button onclick="initAgentlet()" id="initBtn">Initialize agentlet core</button>
                    <button onclick="checkStatus()">Check status</button>
                </div>

                <div class="controls">
                    <h4>Table extraction</h4>
                    <button onclick="extractEmployeesTable()" id="employeesBtn">Extract employees table</button>
                    <button onclick="extractPaginatedTable()" id="paginatedBtn">Extract paginated table</button>
                </div>

                <div class="controls">
                    <h4>Export options</h4>
                    <button onclick="downloadAsExcel()" id="excelBtn">Download as Excel</button>
                    <button onclick="downloadAsCSV()" id="csvBtn">Download as CSV</button>
                    <button onclick="copyAsJSON()" id="jsonBtn">Copy as JSON</button>
                </div>

                <div class="controls">
                    <h4>Advanced features</h4>
                    <button onclick="extractWithMetadata()" id="metadataBtn">Extract with metadata</button>
                    <button onclick="analyzeTableStructure()" id="analyzeBtn">Analyze structure</button>
                    <button onclick="detectDataTypes()" id="typesBtn">Detect data types</button>
                </div>

                <div class="example-section">
                    <h3>Sample tables</h3>
                    
                    <table id="employees-table" class="sample-table">
                        <caption>Employee directory</caption>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Department</th>
                                <th>Position</th>
                                <th>Salary</th>
                                <th>Start date</th>
                                <th>Active</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>001</td>
                                <td>Alice Johnson</td>
                                <td>Engineering</td>
                                <td>Senior developer</td>
                                <td>$85,000</td>
                                <td>2021-03-15</td>
                                <td>✓</td>
                            </tr>
                            <tr>
                                <td>002</td>
                                <td>Bob Smith</td>
                                <td>Marketing</td>
                                <td>Marketing manager</td>
                                <td>$72,000</td>
                                <td>2020-08-22</td>
                                <td>✓</td>
                            </tr>
                            <tr>
                                <td>003</td>
                                <td>Carol Davis</td>
                                <td>Sales</td>
                                <td>Sales representative</td>
                                <td>$58,000</td>
                                <td>2022-01-10</td>
                                <td>✓</td>
                            </tr>
                            <tr>
                                <td>004</td>
                                <td>David Wilson</td>
                                <td>Engineering</td>
                                <td>Junior developer</td>
                                <td>$65,000</td>
                                <td>2023-06-05</td>
                                <td>✓</td>
                            </tr>
                            <tr>
                                <td>005</td>
                                <td>Emma Brown</td>
                                <td>HR</td>
                                <td>HR specialist</td>
                                <td>$62,000</td>
                                <td>2021-11-30</td>
                                <td>○</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="pagination-example">
                        <h4>Paginated customer orders</h4>
                        <table id="orders-table" class="sample-table">
                            <caption>Customer Orders (Page <span id="currentPage">1</span> of <span id="totalPages">3</span>)</caption>
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <!-- Content will be populated by JavaScript -->
                            </tbody>
                        </table>

                        <div class="pagination-controls">
                            <button id="prevPageBtn" onclick="previousPage()" disabled>Previous</button>
                            <span>Page <span id="pageIndicator">1</span> of <span id="totalPagesIndicator">3</span></span>
                            <button id="nextPageBtn" onclick="nextPage()">Next</button>
                        </div>
                    </div>
                </div>

                <div class="example-section">
                    <h3>Table extraction API reference</h3>
                    <div class="code-block">
                        <h4>Basic extraction</h4>
                        <pre><code class="language-javascript">// Extract table data
const tableData = window.agentlet.tables.extract(tableElement);

// Extract all tables on page
const allTables = document.querySelectorAll('table');
const allData = Array.from(allTables).map(table => 
    window.agentlet.tables.extract(table)
);</code></pre>
                        
                        <h4>Excel export</h4>
                        <pre><code class="language-javascript">// Download as Excel file
const result = window.agentlet.tables.download(tableData, {
    filename: 'data.xlsx',
    sheetName: 'Sheet1',
    includeMetadata: true
});

// Extract and download in one step
const result = await window.agentlet.tables.extractAndDownload(tableElement, {
    filename: 'extracted-data.xlsx'
});</code></pre>
                        
                        <h4>Advanced options</h4>
                        <pre><code class="language-javascript">// Extract with metadata and data type detection
const data = window.agentlet.tables.extract(tableElement, {
    includeMetadata: true,
    includeStyles: true,
    detectDataTypes: true
});

// Extract all pages from paginated table
const allData = await window.agentlet.tables.extractAll(tableElement, {
    nextButtonSelector: '#nextPageBtn',
    maxPages: 10,
    delay: 500  // ms between page navigation
});</code></pre>
                    </div>
                </div>
            </div>

            <!-- Right Column: Console and Status -->
            <div class="right-column">
                <div class="console-header">
                    <h3>Console output</h3>
                    <button onclick="clearConsole()" class="console-clear-btn">Clear</button>
                </div>
                <div class="console-section" id="console"></div>

                <h3>Status</h3>
                <div class="status-section" id="status">
                    Click "Initialize agentlet core" to start the demo.
                </div>


            </div>
        </div>
    </div>

    <!-- Console utilities -->
    <script src="../shared/console-utils.js"></script>

    <style>
        .sample-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .sample-table caption {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #495057;
        }
        
        .sample-table th {
            background: #007bff;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #0056b3;
        }
        
        .sample-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .sample-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .sample-table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .sample-table tbody tr:nth-child(even):hover {
            background: #f0f0f0;
        }

        /* Highlight extracted tables */
        .extracted-table {
            outline: 3px solid #28a745;
            outline-offset: 2px;
            background: rgba(40, 167, 69, 0.05);
        }

        /* Pagination styling */
        .pagination-example {
            margin: 20px 0;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .pagination-controls button {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            background: white;
            color: black;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-controls button:hover:not(:disabled) {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .pagination-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>

    <script>
        let lastExtractedData = null;

        // Pagination variables
        let currentPageNumber = 1;
        let totalPagesCount = 3;

        // Sample paginated data
        const paginatedOrdersData = {
            1: [
                ['ORD001', 'John Smith', 'MacBook Pro', '1', '$2,399.00', '2024-01-15'],
                ['ORD002', 'Jane Doe', 'iPhone 15', '2', '$1,998.00', '2024-01-15'],
                ['ORD003', 'Bob Johnson', 'iPad Air', '1', '$599.00', '2024-01-14'],
                ['ORD004', 'Alice Brown', 'Apple Watch', '3', '$1,197.00', '2024-01-14'],
                ['ORD005', 'Charlie Wilson', 'AirPods Pro', '2', '$498.00', '2024-01-13']
            ],
            2: [
                ['ORD006', 'Diana Miller', 'MacBook Air', '1', '$1,199.00', '2024-01-13'],
                ['ORD007', 'Frank Davis', 'iPhone 15 Pro', '1', '$1,199.00', '2024-01-12'],
                ['ORD008', 'Grace Lee', 'iPad Pro', '1', '$1,099.00', '2024-01-12'],
                ['ORD009', 'Henry Taylor', 'Apple Watch Ultra', '1', '$799.00', '2024-01-11'],
                ['ORD010', 'Ivy Clark', 'Mac Mini', '1', '$599.00', '2024-01-11']
            ],
            3: [
                ['ORD011', 'Jack White', 'Studio Display', '1', '$1,599.00', '2024-01-10'],
                ['ORD012', 'Karen Green', 'Magic Keyboard', '2', '$358.00', '2024-01-10'],
                ['ORD013', 'Leo Martinez', 'AirPods Max', '1', '$549.00', '2024-01-09'],
                ['ORD014', 'Mia Rodriguez', 'HomePod mini', '3', '$297.00', '2024-01-09'],
                ['ORD015', 'Noah Anderson', 'Apple TV 4K', '1', '$179.00', '2024-01-08']
            ]
        };

        // Configure Agentlet
        window.agentletConfig = {
            debugMode: true,
            theme: 'default',
            startMinimized: true  // Start with panel minimized
        };


        function checkStatus() {
            log('Checking Agentlet and tables status...');
            
            if (window.agentlet && window.agentlet.tables) {
                log('Tables API is available', 'success');
                log(`Available methods: ${Object.keys(window.agentlet.tables).join(', ')}`);
                updateStatus('Tables API ready for use!', 'success');
            } else if (window.agentlet) {
                log('Agentlet loaded but tables API not found', 'warning');
                updateStatus('Agentlet loaded but tables API not available', 'warning');
            } else {
                log('Agentlet not initialized yet', 'warning');
                updateStatus('Please initialize Agentlet Core first', 'warning');
            }
            
        }

        async function initAgentlet() {
            try {
                setButtonLoading('initBtn', true);
                updateStatus('Loading Agentlet Core...', 'info');
                log('Initializing Agentlet Core...');

                if (window.agentlet) {
                    log('Agentlet already loaded', 'warning');
                    updateStatus('Ready to test table extraction.', 'success');
                    setButtonLoading('initBtn', false);
                            return;
                }

                // Simulate loading delay for demonstration
                await new Promise(resolve => setTimeout(resolve, 500));

                const script = document.createElement('script');
                script.src = '../../../dist/agentlet-core.js?' + Date.now();
                
                script.onload = () => {
                    log('Agentlet Core script loaded successfully', 'success');
                    
                    let AgentletConstructor = null;
                    if (window.AgentletCore) {
                        AgentletConstructor = window.AgentletCore.default;
                    }
                    
                    if (AgentletConstructor) {
                        try {
                            log('Creating AgentletCore instance...');
                            const agentletInstance = new AgentletConstructor(window.agentletConfig);
                                
                            log('Starting initialization...');
                            agentletInstance.init().then(() => {
                                if (window.agentlet && window.agentlet.tables) {
                                    log('Agentlet Core loaded with Table utilities', 'success');
                                    log(`Available table methods: ${Object.keys(window.agentlet.tables).join(', ')}`);
                                    updateStatus('Ready to test table extraction.', 'success');
                                } else {
                                    log('Table utilities not available', 'error');
                                    updateStatus('Table utilities not available', 'error');
                                }
                                                    setButtonLoading('initBtn', false);
                            }).catch(error => {
                                log(`Initialization failed: ${error.message}`, 'error');
                                updateStatus('Initialization failed: ' + error.message, 'error');
                                setButtonLoading('initBtn', false);
                            });
                                
                        } catch (error) {
                            log(`Error creating AgentletCore instance: ${error.message}`, 'error');
                            updateStatus('Error creating instance: ' + error.message, 'error');
                            setButtonLoading('initBtn', false);
                        }
                    } else {
                        log('AgentletCore constructor not available', 'error');
                        updateStatus('AgentletCore constructor not found', 'error');
                        setButtonLoading('initBtn', false);
                    }
                };

                script.onerror = () => {
                    log('Failed to load Agentlet Core script', 'error');
                    updateStatus('Failed to load Agentlet Core. Make sure you ran "npm run build" first.', 'error');
                    setButtonLoading('initBtn', false);
                };

                document.head.appendChild(script);

            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                updateStatus('Initialization error: ' + error.message, 'error');
                setButtonLoading('initBtn', false);
            }
        }

        function checkTables() {
            if (!window.agentlet || !window.agentlet.tables) {
                updateStatus('Table utilities not available. Initialize Agentlet first.', 'warning');
                return false;
            }
            return true;
        }

        function extractEmployeesTable() {
            if (!checkTables()) return;

            try {
                setButtonLoading('employeesBtn', true);
                const employeesTable = document.getElementById('employees-table');
                const extractedData = window.agentlet.tables.extract(employeesTable);
                
                log('Employees table extracted:');
                log(`   Rows: ${extractedData.rows.length}`);
                log(`   Columns: ${extractedData.headers.length}`);
                log(`   Headers: ${extractedData.headers.join(', ')}`);
                
                // Show sample data
                if (extractedData.rows.length > 0) {
                    log(`   Sample row: ${JSON.stringify(extractedData.rows[0])}`);
                }
                
                highlightTable(employeesTable);
                lastExtractedData = extractedData;
                log('Employees table extraction completed', 'success');
                updateStatus(`Employees table extracted: ${extractedData.rows.length} rows`, 'success');
                setTimeout(() => setButtonLoading('employeesBtn', false), 300);
            } catch (error) {
                log(`Error extracting employees table: ${error.message}`, 'error');
                updateStatus('Error extracting table', 'error');
                setButtonLoading('employeesBtn', false);
            }
        }


        async function extractPaginatedTable() {
            if (!checkTables()) return;

            try {
                setButtonLoading('paginatedBtn', true);
                const ordersTable = document.getElementById('orders-table');

                log('Extracting paginated table with all pages...');

                // Use the extractAllPages method for pagination
                const extractedData = await window.agentlet.tables.extractAll(ordersTable, {
                    nextButtonSelector: '#nextPageBtn',
                    maxPages: totalPagesCount,
                    delay: 500  // 500ms delay between pages
                });

                log('Paginated table extracted:');
                log(`   Total pages processed: ${extractedData.metadata?.totalPages || 'unknown'}`);
                log(`   Total rows: ${extractedData.rows.length}`);
                log(`   Columns: ${extractedData.headers.length}`);
                log(`   Headers: ${extractedData.headers.join(', ')}`);

                // Show sample from each page
                if (extractedData.rows.length > 0) {
                    log(`   Sample rows:`);
                    extractedData.rows.slice(0, 3).forEach((row, index) => {
                        const rowObj = {};
                        extractedData.headers.forEach((header, i) => {
                            rowObj[header] = row[i];
                        });
                        log(`     Row ${index + 1}: ${JSON.stringify(rowObj)}`);
                    });
                }

                highlightTable(ordersTable);
                lastExtractedData = extractedData;
                log('Paginated table extraction completed', 'success');
                updateStatus(`Paginated table extracted: ${extractedData.rows.length} total rows`, 'success');
                setTimeout(() => setButtonLoading('paginatedBtn', false), 300);
            } catch (error) {
                log(`Error extracting paginated table: ${error.message}`, 'error');
                updateStatus('Error extracting paginated table', 'error');
                setButtonLoading('paginatedBtn', false);
            }
        }

        function downloadAsExcel() {
            if (!checkTables() || !lastExtractedData) {
                updateStatus('No extracted data available. Extract a table first.', 'warning');
                return;
            }

            try {
                setButtonLoading('excelBtn', true);
                let result;
                if (Array.isArray(lastExtractedData)) {
                    // Multiple tables
                    result = window.agentlet.tables.download(lastExtractedData, {
                        filename: 'extracted-tables.xlsx',
                        includeMetadata: true
                    });
                } else {
                    // Single table
                    result = window.agentlet.tables.download(lastExtractedData, {
                        filename: 'extracted-table.xlsx',
                        sheetName: 'Data',
                        includeMetadata: true
                    });
                }
                
                log('Excel download initiated');
                log(`   File: ${result.filename || 'extracted-data.xlsx'}`);
                updateStatus('Excel file downloaded successfully', 'success');
                setTimeout(() => setButtonLoading('excelBtn', false), 300);
            } catch (error) {
                log(`Error downloading Excel: ${error.message}`, 'error');
                updateStatus('Excel download failed', 'error');
                setButtonLoading('excelBtn', false);
            }
        }

        function downloadAsCSV() {
            if (!lastExtractedData) {
                updateStatus('No extracted data available. Extract a table first.', 'warning');
                return;
            }

            try {
                setButtonLoading('csvBtn', true);
                // Convert to CSV format and download
                const data = Array.isArray(lastExtractedData) ? lastExtractedData[0].data : lastExtractedData;
                const csvContent = convertToCSV(data);
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'extracted-table.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                log('CSV download initiated');
                updateStatus('CSV file downloaded successfully', 'success');
                setTimeout(() => setButtonLoading('csvBtn', false), 300);
            } catch (error) {
                log(`Error downloading CSV: ${error.message}`, 'error');
                updateStatus('CSV download failed', 'error');
                setButtonLoading('csvBtn', false);
            }
        }

        function copyAsJSON() {
            if (!lastExtractedData) {
                updateStatus('No extracted data available. Extract a table first.', 'warning');
                return;
            }

            try {
                setButtonLoading('jsonBtn', true);
                const jsonString = JSON.stringify(lastExtractedData, null, 2);
                navigator.clipboard.writeText(jsonString).then(() => {
                    log('JSON data copied to clipboard');
                    log(`JSON size: ${jsonString.length} characters`);
                    updateStatus('JSON data copied to clipboard', 'success');
                    setTimeout(() => setButtonLoading('jsonBtn', false), 300);
                }).catch(error => {
                    log(`Error copying to clipboard: ${error.message}`, 'error');
                    log('JSON data:');
                    log(jsonString);
                    updateStatus('JSON data logged to output (clipboard failed)', 'warning');
                    setButtonLoading('jsonBtn', false);
                });
            } catch (error) {
                log(`Error preparing JSON: ${error.message}`, 'error');
                updateStatus('JSON copy failed', 'error');
                setButtonLoading('jsonBtn', false);
            }
        }

        function extractWithMetadata() {
            if (!checkTables()) return;

            try {
                setButtonLoading('metadataBtn', true);
                const employeesTable = document.getElementById('employees-table');
                const extractedData = window.agentlet.tables.extract(employeesTable, {
                    includeMetadata: true,
                    includeStyles: true,
                    detectDataTypes: true
                });
                
                log('Extraction with metadata:');
                log(`   Table dimensions: ${extractedData.metadata.totalRows} rows × ${extractedData.metadata.totalColumns} columns`);
                log(`   Table ID: ${extractedData.metadata.tableId || 'none'}`);
                log(`   Caption: ${employeesTable.caption?.textContent || 'none'}`);
                log(`   Extracted at: ${extractedData.metadata.extractedAt}`);
                log(`   Headers: ${extractedData.headers.join(', ')}`);

                // Detect data types from the actual data
                if (extractedData.headers && extractedData.rows.length > 0) {
                    log('   Data type analysis:');
                    extractedData.headers.forEach((header, index) => {
                        const columnData = extractedData.rows.map(row => row[index] || '');
                        const type = inferDataType(columnData);
                        log(`     ${header}: ${type}`);
                    });
                }
                
                lastExtractedData = extractedData;
                log('Metadata extraction completed', 'success');
                updateStatus('Extraction with metadata completed', 'success');
                setTimeout(() => setButtonLoading('metadataBtn', false), 300);
            } catch (error) {
                log(`Error extracting with metadata: ${error.message}`, 'error');
                updateStatus('Metadata extraction failed', 'error');
                setButtonLoading('metadataBtn', false);
            }
        }

        function analyzeTableStructure() {
            if (!checkTables()) return;

            try {
                setButtonLoading('analyzeBtn', true);
                const tables = document.querySelectorAll('.sample-table');
                log('Analyzing table structures:');
                
                tables.forEach((table, index) => {
                    const tableName = table.caption?.textContent || `Table ${index + 1}`;
                    const rows = table.querySelectorAll('tr');
                    const headerCells = table.querySelectorAll('th');
                    const dataCells = table.querySelectorAll('td');
                    
                    log(`   ${tableName}:`);
                    log(`     Rows: ${rows.length}`);
                    log(`     Header cells: ${headerCells.length}`);
                    log(`     Data cells: ${dataCells.length}`);
                    log(`     Structure: ${table.querySelector('thead') ? 'has thead' : 'no thead'}, ${table.querySelector('tbody') ? 'has tbody' : 'no tbody'}`);
                });
                
                updateStatus('Table structure analysis completed', 'success');
                setTimeout(() => setButtonLoading('analyzeBtn', false), 300);
            } catch (error) {
                log(`Error analyzing structure: ${error.message}`, 'error');
                updateStatus('Structure analysis failed', 'error');
                setButtonLoading('analyzeBtn', false);
            }
        }

        function detectDataTypes() {
            if (!lastExtractedData) {
                updateStatus('No extracted data available. Extract a table first.', 'warning');
                return;
            }

            try {
                setButtonLoading('typesBtn', true);
                const data = Array.isArray(lastExtractedData) ? lastExtractedData[0].data : lastExtractedData;
                
                log('Detecting data types:');
                
                if (data.headers && data.rows.length > 0) {
                    data.headers.forEach((header, index) => {
                        const columnData = data.rows.map(row => row[header] || row[index]);
                        const detectedType = inferDataType(columnData);
                        log(`   ${header}: ${detectedType}`);
                    });
                }
                
                updateStatus('Data type detection completed', 'success');
                setTimeout(() => setButtonLoading('typesBtn', false), 300);
            } catch (error) {
                log(`Error detecting data types: ${error.message}`, 'error');
                updateStatus('Data type detection failed', 'error');
                setButtonLoading('typesBtn', false);
            }
        }

        function highlightTable(table) {
            // Remove highlighting from all tables
            document.querySelectorAll('.sample-table').forEach(t => {
                t.classList.remove('extracted-table');
            });
            
            // Highlight the extracted table
            table.classList.add('extracted-table');
            
            // Remove highlighting after 3 seconds
            setTimeout(() => {
                table.classList.remove('extracted-table');
            }, 3000);
        }

        function convertToCSV(data) {
            if (!data.headers || !data.rows) return '';
            
            const csvRows = [];
            csvRows.push(data.headers.join(','));
            
            data.rows.forEach(row => {
                const csvRow = data.headers.map(header => {
                    const value = row[header] || '';
                    return `"${value.toString().replace(/"/g, '""')}"`;
                });
                csvRows.push(csvRow.join(','));
            });
            
            return csvRows.join('\n');
        }

        function inferDataType(values) {
            if (!values || values.length === 0) return 'unknown';
            
            const nonEmptyValues = values.filter(v => v !== null && v !== undefined && v !== '');
            if (nonEmptyValues.length === 0) return 'empty';
            
            // Check for numbers
            const numberPattern = /^[\d,.$%]+$/;
            const datePattern = /^\d{4}-\d{2}-\d{2}$/;
            const booleanPattern = /^(true|false|yes|no|✓|○|×|✗)$/i;
            
            let numbers = 0, dates = 0, booleans = 0;
            
            nonEmptyValues.forEach(value => {
                const str = value.toString().trim();
                if (booleanPattern.test(str)) booleans++;
                else if (datePattern.test(str)) dates++;
                else if (numberPattern.test(str)) numbers++;
            });
            
            const total = nonEmptyValues.length;
            if (booleans / total > 0.8) return 'boolean';
            if (dates / total > 0.8) return 'date';
            if (numbers / total > 0.8) return 'number';
            
            return 'string';
        }

        // Pagination functions
        function loadPageData(pageNumber) {
            const tbody = document.getElementById('ordersTableBody');
            const data = paginatedOrdersData[pageNumber] || [];

            tbody.innerHTML = '';
            data.forEach(rowData => {
                const row = document.createElement('tr');
                rowData.forEach(cellData => {
                    const cell = document.createElement('td');
                    cell.textContent = cellData;
                    row.appendChild(cell);
                });
                tbody.appendChild(row);
            });

            // Update page indicators
            document.getElementById('currentPage').textContent = pageNumber;
            document.getElementById('totalPages').textContent = totalPagesCount;
            document.getElementById('pageIndicator').textContent = pageNumber;
            document.getElementById('totalPagesIndicator').textContent = totalPagesCount;

            // Update button states
            document.getElementById('prevPageBtn').disabled = pageNumber === 1;
            document.getElementById('nextPageBtn').disabled = pageNumber === totalPagesCount;
        }

        function nextPage() {
            if (currentPageNumber < totalPagesCount) {
                currentPageNumber++;
                loadPageData(currentPageNumber);
            }
        }

        function previousPage() {
            if (currentPageNumber > 1) {
                currentPageNumber--;
                loadPageData(currentPageNumber);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            log('Table extraction demo ready', 'success');
            updateStatus('Ready for Agentlet initialization', 'info');

            // Load initial pagination data
            loadPageData(1);
        });

    </script>
</body>
</html>