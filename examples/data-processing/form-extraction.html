<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Form Extraction - Agentlet Core Example</title>
    <link rel="icon" type="image/x-icon" href="../../resources/favicons/favicon.ico">
    <link rel="stylesheet" href="../shared/examples.css">
    <link rel="stylesheet" href="../shared/two-column-layout.css">
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="two-column-container">
            <!-- Left Column: Content and Controls -->
            <div class="left-column">
                <div class="nav-breadcrumb">
                    <a href="../">Examples</a> → data-processing → form-extraction
                </div>

                <h1>Simple form extraction</h1>

                <p>This example demonstrates how to extract structured data from HTML forms using Agentlet Core.</p>

                <div class="example-section">
                    <h3>What this example shows:</h3>
                    <ul>
                        <li>Basic form data extraction</li>
                        <li>Field metadata collection (labels, types, values)</li>
                        <li>AI-ready format export</li>
                        <li>Quick export for simple use cases</li>
                    </ul>
                </div>

                <div class="controls">
                    <h4>Initialize</h4>
                    <button onclick="initAgentlet()" id="initBtn">Initialize agentlet core</button>
                    <button onclick="checkStatus()">Check status</button>
                </div>

                <div class="controls">
                    <h4>Form extraction and export</h4>
                    <button onclick="extractContactForm()" id="extractContactBtn">Extract contact form</button>
                    <button onclick="extractAllForms()" id="extractAllBtn">Extract all forms</button>
                    <button onclick="quickExportContact()" id="quickExportBtn">Quick export</button>
                    <button onclick="aiExportContact()" id="aiExportBtn">AI export</button>
                    <button onclick="debugFormMethods()" id="debugBtn">Debug form methods</button>
                </div>

                <div class="example-section">
                    <h3>Fill sample data</h3>
                    <p>Click to fill forms with sample data for testing extraction:</p>
                    <div class="controls">
                        <button onclick="fillContactForm()" id="fillContactBtn">Fill contact form</button>
                        <button onclick="fillRegistrationForm()" id="fillRegistrationBtn">Fill registration form</button>
                    </div>
                </div>

                <div class="example-section">
                    <h3>Sample forms</h3>
                    
                    <form id="contact-form" class="test-form">
                        <h4>Contact form</h4>
                        <label for="name">Full Name *</label>
                        <input type="text" id="name" name="name" placeholder="Enter your full name" required>
                        
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" name="email" placeholder="you@example.com" required>
                        
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" placeholder="+1 (555) 123-4567">
                        
                        <label for="company">Company</label>
                        <input type="text" id="company" name="company" placeholder="Your company name">
                        
                        <label for="subject">Subject</label>
                        <select id="subject" name="subject">
                            <option value="">Select a subject</option>
                            <option value="general">General Inquiry</option>
                            <option value="support">Technical Support</option>
                            <option value="sales">Sales Question</option>
                            <option value="partnership">Partnership</option>
                        </select>
                        
                        <label for="message">Message</label>
                        <textarea id="message" name="message" rows="4" placeholder="Your message here..."></textarea>
                        
                        <label>
                            <input type="checkbox" name="newsletter" value="yes"> Subscribe to newsletter
                        </label>
                        
                        <button type="submit">Send Message</button>
                    </form>

                    <form id="registration-form" class="test-form">
                        <h4>User registration</h4>
                        <label for="username">Username *</label>
                        <input type="text" id="username" name="username" placeholder="Choose a username" required>
                        
                        <label for="password">Password *</label>
                        <input type="password" id="password" name="password" placeholder="Create a password" required>
                        
                        <label for="birthdate">Birth Date</label>
                        <input type="date" id="birthdate" name="birthdate">
                        
                        <label for="country">Country</label>
                        <select id="country" name="country">
                            <option value="">Select your country</option>
                            <option value="us">United States</option>
                            <option value="ca">Canada</option>
                            <option value="uk">United Kingdom</option>
                            <option value="fr">France</option>
                            <option value="de">Germany</option>
                        </select>
                        
                        <fieldset>
                            <legend>Interests</legend>
                            <label><input type="checkbox" name="interests" value="tech"> Technology</label>
                            <label><input type="checkbox" name="interests" value="sports"> Sports</label>
                            <label><input type="checkbox" name="interests" value="music"> Music</label>
                            <label><input type="checkbox" name="interests" value="travel"> Travel</label>
                        </fieldset>
                        
                        <fieldset>
                            <legend>Account Type</legend>
                            <label><input type="radio" name="account_type" value="personal"> Personal</label>
                            <label><input type="radio" name="account_type" value="business"> Business</label>
                        </fieldset>
                        
                        <button type="submit">Register</button>
                    </form>
                </div>


                <div class="example-section">
                    <h3>Form extraction API reference:</h3>
                    <div class="code-block">
                        <h4>Basic Extraction</h4>
                        <pre><code class="language-javascript">// Extract form structure
const formData = window.agentlet.forms.extract(formElement);

// Quick export (simple array)
const quickData = window.agentlet.forms.quickExport(formElement);

// AI-ready export
const aiData = window.agentlet.forms.exportForAI(formElement);</code></pre>
                        
                        <h4>Advanced Options</h4>
                        <pre><code class="language-javascript">// Full extraction with options
const fullData = window.agentlet.forms.extract(formElement, {
    includeBoundingBoxes: true,
    includeStyles: true,
    includeValidation: true
});</code></pre>
                    </div>
                </div>
            </div>

            <!-- Right Column: Console and Status -->
            <div class="right-column">
                <div class="console-header">
                    <h3>Console output</h3>
                    <button onclick="clearConsole()" class="console-clear-btn">Clear</button>
                </div>
                <div class="console-section" id="console"></div>
                
                <h3>Status</h3>
                <div class="status-section" id="status">
                    Click "Initialize Agentlet Core" to start the demo.
                </div>
                
                
            </div>
        </div>
    </div>

    <!-- Console utilities -->
    <script src="../shared/console-utils.js"></script>

    <style>
        .test-form {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .test-form h4 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #007bff;
            padding-bottom: 8px;
        }
        
        .test-form label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: 500;
        }
        
        .test-form input, .test-form select, .test-form textarea {
            width: 100%;
            max-width: 400px;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .test-form fieldset {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .test-form fieldset label {
            display: inline-block;
            margin: 5px 15px 5px 0;
            font-weight: normal;
        }
        
        .test-form fieldset input[type="checkbox"],
        .test-form fieldset input[type="radio"] {
            width: auto;
            margin-right: 8px;
            margin-bottom: 0;
        }
        
        .test-form button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .test-form button:hover {
            background: #0056b3;
        }
    </style>

    <script>
        
        // Configure Agentlet
        window.agentletConfig = {
            debugMode: true,
            theme: 'default',
            startMinimized: true  // Start with panel minimized
        };


        function checkStatus() {
            log('🔍 Checking Agentlet and forms status...');
            
            if (window.agentlet && window.agentlet.forms) {
                log('✅ Forms API is available', 'success');
                log(`📋 Available methods: ${Object.keys(window.agentlet.forms).join(', ')}`);
                updateStatus('Forms API ready for use!', 'success');
            } else if (window.agentlet) {
                log('⚠️ Agentlet loaded but forms API not found', 'warning');
                updateStatus('Agentlet loaded but forms API not available', 'warning');
            } else {
                log('❌ Agentlet not initialized yet', 'warning');
                updateStatus('Please initialize Agentlet Core first', 'warning');
            }
            
        }

        async function initAgentlet() {
            try {
                setButtonLoading('initBtn', true);
                updateStatus('Loading Agentlet Core...', 'info');
                log('🤖 Initializing Agentlet Core...');

                if (window.agentlet) {
                    log('⚠️ Agentlet already loaded', 'warning');
                    updateStatus('Ready! Try the form extraction buttons above.', 'success');
                    setButtonLoading('initBtn', false);
                            return;
                }

                // Simulate loading delay for demonstration
                await new Promise(resolve => setTimeout(resolve, 500));

                const script = document.createElement('script');
                script.src = '../../../dist/agentlet-core.js?' + Date.now();
                
                script.onload = () => {
                    log('✅ Agentlet Core script loaded successfully', 'success');
                    
                    let AgentletConstructor = null;
                    if (window.AgentletCore) {
                        AgentletConstructor = window.AgentletCore.default;
                    }
                    
                    if (AgentletConstructor) {
                        try {
                            log('🚀 Creating AgentletCore instance...');
                            const agentletInstance = new AgentletConstructor(window.agentletConfig);
                                
                            log('⚙️ Starting initialization...');
                            agentletInstance.init().then(() => {
                                if (window.agentlet && window.agentlet.forms) {
                                    log('✅ Agentlet Core loaded with Form utilities', 'success');
                                    log(`📋 Available form methods: ${Object.keys(window.agentlet.forms).join(', ')}`);
                                    updateStatus('Ready! Try the form extraction buttons above.', 'success');
                                } else {
                                    log('❌ Form utilities not available', 'error');
                                    updateStatus('Form utilities not available', 'error');
                                }
                                                    setButtonLoading('initBtn', false);
                            }).catch(error => {
                                log(`❌ Initialization failed: ${error.message}`, 'error');
                                updateStatus('Initialization failed: ' + error.message, 'error');
                                setButtonLoading('initBtn', false);
                            });
                                
                        } catch (error) {
                            log(`❌ Error creating AgentletCore instance: ${error.message}`, 'error');
                            updateStatus('Error creating instance: ' + error.message, 'error');
                            setButtonLoading('initBtn', false);
                        }
                    } else {
                        log('❌ AgentletCore constructor not available', 'error');
                        updateStatus('AgentletCore constructor not found', 'error');
                        setButtonLoading('initBtn', false);
                    }
                };

                script.onerror = () => {
                    log('❌ Failed to load Agentlet Core script', 'error');
                    updateStatus('Failed to load Agentlet Core. Make sure you ran "npm run build" first.', 'error');
                    setButtonLoading('initBtn', false);
                };

                document.head.appendChild(script);

            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
                updateStatus('Initialization error: ' + error.message, 'error');
                setButtonLoading('initBtn', false);
            }
        }

        function checkForms() {
            if (!window.agentlet || !window.agentlet.forms) {
                updateStatus('Form utilities not available. Initialize Agentlet first.', 'warning');
                return false;
            }
            return true;
        }

        function extractContactForm() {
            if (!checkForms()) return;

            try {
                setButtonLoading('extractContactBtn', true);
                const contactForm = document.getElementById('contact-form');
                
                // Check if extract method exists and what it expects
                if (!window.agentlet.forms.extract) {
                    log('❌ forms.extract method not found', 'error');
                    log(`📋 Available methods: ${Object.keys(window.agentlet.forms).join(', ')}`);
                    updateStatus('Form extract method not available', 'error');
                    setButtonLoading('extractContactBtn', false);
                    return;
                }
                
                log('📋 Attempting to extract contact form...');
                const extractedData = window.agentlet.forms.extract(contactForm);
                
                log('📋 Contact form extracted successfully:');
                log(`   Fields found: ${extractedData.fields?.length || 'unknown'}`);
                log(`   Form action: ${extractedData.action || 'none'}`);
                log(`   Form method: ${extractedData.method || 'GET'}`);
                
                // Log field details safely
                if (extractedData.fields && Array.isArray(extractedData.fields)) {
                    extractedData.fields.forEach((field, index) => {
                        log(`   Field ${index + 1}: ${field.name || 'unnamed'} (${field.type || 'unknown'}) - "${field.label || 'no label'}"`);
                    });
                } else {
                    log('   Fields data not in expected format');
                }
                
                log(`📊 Full extraction data: ${JSON.stringify(extractedData, null, 2)}`);
                log('📋 Contact Form extraction completed', 'success');
                updateStatus(`Contact form extracted: ${extractedData.fields?.length || 0} fields found`, 'success');
                setTimeout(() => setButtonLoading('extractContactBtn', false), 300);
            } catch (error) {
                log(`❌ Error extracting contact form: ${error.message}`, 'error');
                log(`❌ Error stack: ${error.stack}`);
                
                // Fallback: try alternative methods
                log('🔄 Attempting fallback extraction...', 'info');
                try {
                    if (window.agentlet.forms.quickExport) {
                        const quickData = window.agentlet.forms.quickExport(document.getElementById('contact-form'));
                        log(`✅ Fallback quickExport successful: ${JSON.stringify(quickData, null, 2)}`, 'success');
                        log('📋 Contact Form (fallback) extraction completed', 'success');
                        updateStatus('Fallback extraction successful', 'warning');
                    } else {
                        log('❌ No fallback methods available', 'error');
                        updateStatus('Form extraction failed - no fallback available', 'error');
                    }
                } catch (fallbackError) {
                    log(`❌ Fallback also failed: ${fallbackError.message}`, 'error');
                    updateStatus('All extraction methods failed', 'error');
                }
                setButtonLoading('extractContactBtn', false);
            }
        }


        function extractAllForms() {
            if (!checkForms()) return;

            try {
                setButtonLoading('extractAllBtn', true);
                const allForms = document.querySelectorAll('form');
                log(`📋 Extracting ${allForms.length} forms...`);

                let totalFields = 0;
                allForms.forEach((form, index) => {
                    const formId = form.id || `form-${index}`;
                    const extractedData = window.agentlet.forms.extract(form);

                    // Check if fields array exists
                    const fieldCount = (extractedData && extractedData.fields && Array.isArray(extractedData.fields))
                        ? extractedData.fields.length
                        : 0;

                    totalFields += fieldCount;
                    log(`   Form "${formId}": ${fieldCount} fields`);
                });

                log('📋 All Forms extraction completed', 'success');
                updateStatus(`Extracted ${allForms.length} forms successfully (${totalFields} total fields)`, 'success');
                setTimeout(() => setButtonLoading('extractAllBtn', false), 300);
            } catch (error) {
                log(`❌ Error extracting all forms: ${error.message}`, 'error');
                log(`❌ Error stack: ${error.stack}`);
                updateStatus('Error extracting forms', 'error');
                setButtonLoading('extractAllBtn', false);
            }
        }

        function quickExportContact() {
            if (!checkForms()) return;

            try {
                setButtonLoading('quickExportBtn', true);
                const contactForm = document.getElementById('contact-form');
                const quickData = window.agentlet.forms.quickExport(contactForm);
                
                log('⚡ Quick export of contact form:');
                log(`📊 Quick export data: ${JSON.stringify(quickData, null, 2)}`);
                log('📋 Quick Export extraction completed', 'success');
                updateStatus('Quick export completed', 'success');
                setTimeout(() => setButtonLoading('quickExportBtn', false), 300);
            } catch (error) {
                log(`❌ Error with quick export: ${error.message}`, 'error');
                updateStatus('Quick export failed', 'error');
                setButtonLoading('quickExportBtn', false);
            }
        }

        function aiExportContact() {
            if (!checkForms()) return;

            try {
                setButtonLoading('aiExportBtn', true);
                const contactForm = document.getElementById('contact-form');
                const aiData = window.agentlet.forms.exportForAI(contactForm);
                
                log('🤖 AI-ready export of contact form:');
                log(`📊 AI export data: ${JSON.stringify(aiData, null, 2)}`);
                log('📋 AI Export extraction completed', 'success');
                updateStatus('AI export completed', 'success');
                setTimeout(() => setButtonLoading('aiExportBtn', false), 300);
            } catch (error) {
                log(`❌ Error with AI export: ${error.message}`, 'error');
                updateStatus('AI export failed', 'error');
                setButtonLoading('aiExportBtn', false);
            }
        }


        // Sample data fillers
        function fillContactForm() {
            try {
                setButtonLoading('fillContactBtn', true);
                document.getElementById('name').value = 'John Smith';
                document.getElementById('email').value = 'john.smith@example.com';
                document.getElementById('phone').value = '+1 (555) 123-4567';
                document.getElementById('company').value = 'Acme Corporation';
                document.getElementById('subject').value = 'sales';
                document.getElementById('message').value = 'I am interested in learning more about your products and services. Please contact me at your earliest convenience.';
                document.querySelector('input[name="newsletter"]').checked = true;
                
                log('📝 Contact form filled with sample data', 'success');
                updateStatus('Contact form filled with sample data', 'info');
                setTimeout(() => setButtonLoading('fillContactBtn', false), 300);
            } catch (error) {
                log(`❌ Error filling contact form: ${error.message}`, 'error');
                setButtonLoading('fillContactBtn', false);
            }
        }

        function fillRegistrationForm() {
            try {
                setButtonLoading('fillRegistrationBtn', true);
                document.getElementById('username').value = 'johndoe2024';
                document.getElementById('password').value = 'SecurePassword123!';
                document.getElementById('birthdate').value = '1990-05-15';
                document.getElementById('country').value = 'us';
                
                // Check some interests
                document.querySelector('input[name="interests"][value="tech"]').checked = true;
                document.querySelector('input[name="interests"][value="travel"]').checked = true;
                
                // Select account type
                document.querySelector('input[name="account_type"][value="personal"]').checked = true;
                
                log('📝 Registration form filled with sample data', 'success');
                updateStatus('Registration form filled with sample data', 'info');
                setTimeout(() => setButtonLoading('fillRegistrationBtn', false), 300);
            } catch (error) {
                log(`❌ Error filling registration form: ${error.message}`, 'error');
                setButtonLoading('fillRegistrationBtn', false);
            }
        }

        // Prevent actual form submission
        document.addEventListener('submit', (e) => {
            e.preventDefault();
            log('📝 Form submission prevented (demo mode)', 'info');
        });

        // Debug and troubleshooting functions
        function debugFormMethods() {
            setButtonLoading('debugBtn', true);
            log('🔍 Debugging form methods...');
            
            if (!window.agentlet) {
                log('❌ window.agentlet not available', 'error');
                setButtonLoading('debugBtn', false);
                return;
            }
            
            log('✅ window.agentlet available', 'success');
            log(`📋 Agentlet properties: ${Object.keys(window.agentlet).join(', ')}`);
            
            if (window.agentlet.forms) {
                log('✅ window.agentlet.forms available', 'success');
                log(`📋 Forms methods: ${Object.keys(window.agentlet.forms).join(', ')}`);
                
                // Check each method
                ['extract', 'quickExport', 'exportForAI', 'fill', 'fillFromAI'].forEach(method => {
                    const available = typeof window.agentlet.forms[method] === 'function';
                    log(`   ${method}: ${available ? '✅ available' : '❌ missing'}`, available ? 'success' : 'error');
                });
            } else {
                log('❌ window.agentlet.forms not available', 'error');
            }
            
            updateStatus('Debug information logged', 'info');
            setTimeout(() => setButtonLoading('debugBtn', false), 300);
        }



        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            log('📄 Form extraction demo ready', 'success');
            updateStatus('Ready for Agentlet initialization', 'info');
        });

    </script>
</body>
</html>