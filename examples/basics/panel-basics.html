<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Basics - Agentlet Core Example</title>
    <link rel="icon" type="image/x-icon" href="../../resources/favicons/favicon.ico">
    <link rel="stylesheet" href="../shared/examples.css">
    <link rel="stylesheet" href="../shared/two-column-layout.css">
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="two-column-container">
            <!-- Left Column: Content and Controls -->
            <div class="left-column">
                <div class="nav-breadcrumb">
                    <a href="../">Examples</a> → <a href="./">basics</a> → panel-basics
                </div>

                <h1>🎛️ Panel Basics - Agentlet Core</h1>
                
                <p>This example demonstrates basic panel operations like minimize/maximize, resizing, and API interactions.</p>

                <div class="example-section">
                    <h3>What this example shows:</h3>
                    <ul>
                        <li>Panel minimize and maximize functionality</li>
                        <li>Panel resizing with mouse drag and programmatic API</li>
                        <li>Panel API methods</li>
                        <li>Event bus interactions</li>
                        <li>Panel state management</li>
                    </ul>
                </div>

                <div class="controls">
                    <h4>Panel Controls</h4>
                    <button onclick="initAgentlet()" id="initBtn">🚀 Initialize Agentlet</button>
                    <button onclick="minimizePanel()" id="minBtn">⬇️ Minimize Panel</button>
                    <button onclick="maximizePanel()" id="maxBtn">⬆️ Maximize Panel</button>
                    <button onclick="togglePanel()" id="toggleBtn">🔄 Toggle Panel</button>
                    <button onclick="checkPanelState()">📊 Check Panel State</button>
                </div>

                <div class="controls">
                    <h4>Panel Resizing</h4>
                    <button onclick="resizePanelSmall()">📱 Small (320px)</button>
                    <button onclick="resizePanelMedium()">💻 Medium (480px)</button>
                    <button onclick="resizePanelLarge()">🖥️ Large (640px)</button>
                    <button onclick="setPanelCustomWidth()">📏 Custom Width</button>
                    <button onclick="checkPanelWidth()">📐 Check Width</button>
                </div>

                <div class="controls">
                    <h4>Event Bus Demo</h4>
                    <button onclick="setupEventListeners()" id="eventsBtn">👂 Setup Event Listeners</button>
                    <button onclick="triggerCustomEvent()">📢 Trigger Custom Event</button>
                </div>

                <div class="example-section">
                    <h3>📜 Panel Control Code:</h3>
                    <p>Simple methods to control the Agentlet panel programmatically:</p>
                    <div class="code-block">
                        <h4>Panel State Control</h4>
                        <pre><code class="language-javascript">// Minimize the panel
window.agentlet.minimize();

// Maximize the panel  
window.agentlet.maximize();

// Check if panel is minimized
const isMinimized = window.agentlet.isMinimized;</code></pre>
                        
                        <h4>Panel Resizing</h4>
                        <pre><code class="language-javascript">// Resize to preset sizes
window.agentlet.ui.resizePanel('small');   // 320px
window.agentlet.ui.resizePanel('medium');  // 480px
window.agentlet.ui.resizePanel('large');   // 640px

// Resize to custom width
window.agentlet.ui.setPanelWidth(500);

// Get current panel width
const width = window.agentlet.ui.getPanelWidth();

// Listen for resize complete events
window.agentlet.eventBus.on('panel:resizeComplete', (data) => {
    console.log('Panel resized to:', data.width);
});</code></pre>
                        
                        <h4>Event Bus Usage</h4>
                        <pre><code class="language-javascript">// Listen for panel events
window.agentlet.eventBus.on('ui:minimized', () => {
    console.log('Panel was minimized');
});

window.agentlet.eventBus.on('ui:maximized', () => {
    console.log('Panel was maximized'); 
});

// Emit custom events
window.agentlet.eventBus.emit('custom:event', { data: 'example' });</code></pre>
                    </div>
                </div>
            </div>

            <!-- Right Column: Console and Status -->
            <div class="right-column">
                <div class="console-header">
                    <h3>📟 Console Output</h3>
                    <button onclick="clearConsole()" class="console-clear-btn">🗑️ Clear</button>
                </div>
                <div class="console-section" id="console"></div>
                
                <h3>📊 Status</h3>
                <div class="status-section" id="status">
                    Click "Initialize Agentlet" to start the demo.
                </div>
                
                <h3>📈 Statistics</h3>
                <div class="stats-section" id="stats">
                    <div>Messages logged: <span id="messageCount">0</span></div>
                    <div>Errors: <span id="errorCount">0</span></div>
                    <div>Warnings: <span id="warningCount">0</span></div>
                    <div>Last action: <span id="lastAction">None</span></div>
                </div>
                
                <h3>🎛️ Panel State</h3>
                <div class="stats-section" id="panelStats">
                    <div>Panel initialized: <span id="panelInitialized">No</span></div>
                    <div>Panel minimized: <span id="panelMinimized">Unknown</span></div>
                    <div>Panel width: <span id="panelWidth">Unknown</span></div>
                    <div>Resizable: <span id="panelResizable">Unknown</span></div>
                    <div>Event listeners: <span id="eventListeners">Not setup</span></div>
                    <div>Events received: <span id="eventsReceived">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Console utilities -->
    <script src="../shared/console-utils.js"></script>

    <script>
        let eventListenersSetup = false;
        let eventsReceived = 0;

        // Configure Agentlet
        window.agentletConfig = {
            debugMode: true,
            theme: 'default',
            resizablePanel: true,
            minimumPanelWidth: 320
        };

        // Update panel stats display
        function updatePanelStats() {
            const elements = {
                panelInitialized: document.getElementById('panelInitialized'),
                panelMinimized: document.getElementById('panelMinimized'),
                panelWidth: document.getElementById('panelWidth'),
                panelResizable: document.getElementById('panelResizable'),
                eventListeners: document.getElementById('eventListeners'),
                eventsReceived: document.getElementById('eventsReceived')
            };

            if (elements.panelInitialized) {
                elements.panelInitialized.textContent = window.agentlet ? 'Yes' : 'No';
            }
            
            if (elements.panelMinimized && window.agentlet) {
                try {
                    elements.panelMinimized.textContent = window.agentlet.isMinimized ? 'Yes' : 'No';
                } catch (e) {
                    elements.panelMinimized.textContent = 'Unknown';
                }
            }
            
            if (elements.panelWidth && window.agentlet) {
                try {
                    const width = window.agentlet.ui.getPanelWidth();
                    elements.panelWidth.textContent = `${width}px`;
                } catch (e) {
                    elements.panelWidth.textContent = 'Unknown';
                }
            }
            
            if (elements.panelResizable && window.agentlet) {
                try {
                    elements.panelResizable.textContent = window.agentlet.config.resizablePanel ? 'Yes' : 'No';
                } catch (e) {
                    elements.panelResizable.textContent = 'Unknown';
                }
            }
            
            if (elements.eventListeners) {
                elements.eventListeners.textContent = eventListenersSetup ? 'Active' : 'Not setup';
            }
            
            if (elements.eventsReceived) {
                elements.eventsReceived.textContent = eventsReceived;
            }
        }

        async function initAgentlet() {
            try {
                setButtonLoading('initBtn', true);
                updateStatus('Loading Agentlet Core...', 'info');
                log('🤖 Initializing Agentlet Core...');

                if (window.agentlet) {
                    log('⚠️ Agentlet already loaded, reusing instance', 'warning');
                    updateStatus('Agentlet Core already loaded', 'success');
                    setButtonLoading('initBtn', false);
                    updatePanelStats();
                    return;
                }

                // Simulate loading delay for demonstration
                await new Promise(resolve => setTimeout(resolve, 500));

                const script = document.createElement('script');
                script.src = '../../../dist/agentlet-core.js?' + Date.now();
                
                script.onload = () => {
                    log('✅ Agentlet Core script loaded successfully', 'success');
                    
                    let AgentletConstructor = null;
                    if (window.AgentletCore) {
                        AgentletConstructor = window.AgentletCore.default;
                    }
                    
                    if (AgentletConstructor) {
                        try {
                            log('🚀 Creating AgentletCore instance...');
                            const agentletInstance = new AgentletConstructor(window.agentletConfig);
                            
                            log('⚙️ Starting initialization...');
                            agentletInstance.init().then(() => {
                                log('✅ Agentlet Core initialized successfully', 'success');
                                log(`📊 Available APIs: ${Object.keys(window.agentlet || {}).join(', ')}`);
                                updateStatus('Ready! Try the panel controls above.', 'success');
                                setButtonLoading('initBtn', false);
                                updatePanelStats();
                                
                                // Auto-setup event listeners after initialization
                                setTimeout(() => {
                                    if (!eventListenersSetup) {
                                        setupEventListeners();
                                    }
                                }, 500);
                            }).catch(error => {
                                log(`❌ Initialization failed: ${error.message}`, 'error');
                                updateStatus('Initialization failed: ' + error.message, 'error');
                                setButtonLoading('initBtn', false);
                            });
                            
                        } catch (error) {
                            log(`❌ Error creating AgentletCore instance: ${error.message}`, 'error');
                            updateStatus('Error creating instance: ' + error.message, 'error');
                            setButtonLoading('initBtn', false);
                        }
                    } else {
                        log('❌ AgentletCore constructor not available', 'error');
                        log(`🔍 Available in window.AgentletCore: ${Object.keys(window.AgentletCore || {}).join(', ')}`);
                        updateStatus('AgentletCore constructor not found', 'error');
                        setButtonLoading('initBtn', false);
                    }
                };

                script.onerror = () => {
                    log('❌ Failed to load Agentlet Core script', 'error');
                    updateStatus('Failed to load Agentlet Core', 'error');
                    setButtonLoading('initBtn', false);
                };

                document.head.appendChild(script);

            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
                updateStatus('Initialization error', 'error');
                setButtonLoading('initBtn', false);
            }
        }

        function minimizePanel() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                setButtonLoading('minBtn', true);
                window.agentlet.minimize();
                log('⬇️ Panel minimized via API');
                updateStatus('Panel minimized', 'info');
                setTimeout(() => {
                    setButtonLoading('minBtn', false);
                    updatePanelStats();
                }, 300);
            } catch (error) {
                log(`❌ Error minimizing panel: ${error.message}`, 'error');
                updateStatus('Error minimizing panel', 'error');
                setButtonLoading('minBtn', false);
            }
        }

        function maximizePanel() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                setButtonLoading('maxBtn', true);
                window.agentlet.maximize();
                log('⬆️ Panel maximized via API');
                updateStatus('Panel maximized', 'info');
                setTimeout(() => {
                    setButtonLoading('maxBtn', false);
                    updatePanelStats();
                }, 300);
            } catch (error) {
                log(`❌ Error maximizing panel: ${error.message}`, 'error');
                updateStatus('Error maximizing panel', 'error');
                setButtonLoading('maxBtn', false);
            }
        }

        function togglePanel() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                setButtonLoading('toggleBtn', true);
                const isMinimized = window.agentlet.isMinimized;
                if (isMinimized) {
                    window.agentlet.maximize();
                    log('🔄 Panel toggled: minimized → maximized');
                } else {
                    window.agentlet.minimize();
                    log('🔄 Panel toggled: maximized → minimized');
                }
                updateStatus(`Panel toggled to ${isMinimized ? 'maximized' : 'minimized'}`, 'info');
                setTimeout(() => {
                    setButtonLoading('toggleBtn', false);
                    updatePanelStats();
                }, 300);
            } catch (error) {
                log(`❌ Error toggling panel: ${error.message}`, 'error');
                updateStatus('Error toggling panel', 'error');
                setButtonLoading('toggleBtn', false);
            }
        }

        function checkPanelState() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                const state = {
                    isMinimized: window.agentlet.isMinimized,
                    panelExists: !!document.getElementById('agentlet-container'),
                    toggleExists: !!document.getElementById('agentlet-toggle')
                };

                log('📊 Panel State:');
                log(`   Minimized: ${state.isMinimized}`);
                log(`   Panel Element: ${state.panelExists ? 'Present' : 'Missing'}`);
                log(`   Toggle Button: ${state.toggleExists ? 'Present' : 'Missing'}`);

                if (state.panelExists) {
                    const panelElement = document.getElementById('agentlet-container');
                    const computedStyle = getComputedStyle(panelElement);
                    log(`   Visibility: ${computedStyle.visibility}`);
                    log(`   Transform: ${computedStyle.transform}`);
                }

                updateStatus('Panel state logged to console', 'info');
                updatePanelStats();
            } catch (error) {
                log(`❌ Error checking panel state: ${error.message}`, 'error');
                updateStatus('Error checking panel state', 'error');
            }
        }

        function setupEventListeners() {
            if (!window.agentlet || !window.agentlet.eventBus) {
                updateStatus('Agentlet or event bus not available', 'warning');
                return;
            }

            if (eventListenersSetup) {
                log('👂 Event listeners already setup');
                return;
            }

            try {
                setButtonLoading('eventsBtn', true);
                
                // Listen for UI events
                window.agentlet.eventBus.on('ui:minimized', () => {
                    log('📡 Event received: ui:minimized', 'success');
                    eventsReceived++;
                    updatePanelStats();
                });

                window.agentlet.eventBus.on('ui:maximized', () => {
                    log('📡 Event received: ui:maximized', 'success');
                    eventsReceived++;
                    updatePanelStats();
                });

                // Listen for panel resize events
                window.agentlet.eventBus.on('panel:resizeComplete', (data) => {
                    log(`📡 Event received: panel:resizeComplete at ${data.width}px`, 'success');
                    eventsReceived++;
                    updatePanelStats();
                });

                // Listen for custom events
                window.agentlet.eventBus.on('demo:custom', (data) => {
                    log(`📡 Event received: demo:custom with data: ${JSON.stringify(data)}`, 'success');
                    eventsReceived++;
                    updatePanelStats();
                });

                eventListenersSetup = true;
                log('👂 Event listeners setup successfully', 'success');
                updateStatus('Event listeners active - try panel operations to see events', 'success');
                setButtonLoading('eventsBtn', false);
                updatePanelStats();
            } catch (error) {
                log(`❌ Error setting up event listeners: ${error.message}`, 'error');
                updateStatus('Error setting up event listeners', 'error');
                setButtonLoading('eventsBtn', false);
            }
        }

        function triggerCustomEvent() {
            if (!window.agentlet || !window.agentlet.eventBus) {
                updateStatus('Agentlet or event bus not available', 'warning');
                return;
            }

            try {
                const eventData = {
                    timestamp: new Date().toISOString(),
                    source: 'panel-basics-demo',
                    message: 'Hello from custom event!'
                };

                window.agentlet.eventBus.emit('demo:custom', eventData);
                log('📢 Custom event triggered: demo:custom');
                updateStatus('Custom event emitted', 'info');
            } catch (error) {
                log(`❌ Error triggering custom event: ${error.message}`, 'error');
                updateStatus('Error triggering custom event', 'error');
            }
        }

        // Panel resize functions
        function resizePanelSmall() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                window.agentlet.ui.resizePanel('small');
                log('📱 Panel resized to small (320px)');
                updateStatus('Panel resized to small', 'info');
                updatePanelStats();
            } catch (error) {
                log(`❌ Error resizing panel: ${error.message}`, 'error');
                updateStatus('Error resizing panel', 'error');
            }
        }

        function resizePanelMedium() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                window.agentlet.ui.resizePanel('medium');
                log('💻 Panel resized to medium (480px)');
                updateStatus('Panel resized to medium', 'info');
                updatePanelStats();
            } catch (error) {
                log(`❌ Error resizing panel: ${error.message}`, 'error');
                updateStatus('Error resizing panel', 'error');
            }
        }

        function resizePanelLarge() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                window.agentlet.ui.resizePanel('large');
                log('🖥️ Panel resized to large (640px)');
                updateStatus('Panel resized to large', 'info');
                updatePanelStats();
            } catch (error) {
                log(`❌ Error resizing panel: ${error.message}`, 'error');
                updateStatus('Error resizing panel', 'error');
            }
        }

        function setPanelCustomWidth() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                const width = prompt('Enter panel width in pixels (minimum 320):', '400');
                if (width && !isNaN(width)) {
                    const numWidth = parseInt(width);
                    window.agentlet.ui.setPanelWidth(numWidth);
                    log(`📏 Panel resized to custom width: ${numWidth}px`);
                    updateStatus(`Panel resized to ${numWidth}px`, 'info');
                    updatePanelStats();
                } else if (width !== null) {
                    log('❌ Invalid width entered', 'error');
                    updateStatus('Invalid width entered', 'error');
                }
            } catch (error) {
                log(`❌ Error setting custom width: ${error.message}`, 'error');
                updateStatus('Error setting custom width', 'error');
            }
        }

        function checkPanelWidth() {
            if (!window.agentlet) {
                updateStatus('Agentlet not initialized yet', 'warning');
                return;
            }

            try {
                const width = window.agentlet.ui.getPanelWidth();
                log(`📐 Current panel width: ${width}px`);
                updateStatus(`Panel width: ${width}px`, 'info');
                updatePanelStats();
            } catch (error) {
                log(`❌ Error checking panel width: ${error.message}`, 'error');
                updateStatus('Error checking panel width', 'error');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            log('📄 Panel basics example loaded', 'success');
            updateStatus('Ready for Agentlet initialization', 'info');
            updatePanelStats();
        });

        // Update panel stats periodically
        setInterval(updatePanelStats, 2000);
    </script>
</body>
</html>