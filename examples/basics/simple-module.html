<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Module Example - Agentlet Core</title>
    <link rel="stylesheet" href="../shared/examples.css">
    <link rel="stylesheet" href="../shared/two-column-layout.css">
    <script src="../shared/console-utils.js"></script>
</head>
<body>
    <nav class="breadcrumb">
        <a href="../../index.html">Examples</a> &gt; 
        <a href="../index.html">01-basics</a> &gt; 
        <span>simple-module</span>
    </nav>

    <div class="layout-container">
        <main class="main-content">
            <h1>üì¶ Simple Module Example</h1>
            
            <div class="highlight-box">
                <h3>What this example shows</h3>
                <p>How to create and register a simple agentlet module using the new simplified Module API.</p>
            </div>

            <section>
                <h2>1. Create a Simple Module</h2>
                <div class="code-block">
                    <pre><code class="language-javascript">// Create a simple agentlet module
class SimpleModule extends window.agentlet.Module {
    constructor() {
        super({
            name: 'simple-demo',
            patterns: ['*'],  // Match all URLs
            description: 'A simple demonstration module'
        });
    }
    
    async init() {
        console.log('‚úÖ Simple module initialized!');
    }
    
    async activate(context) {
        console.log('üîÑ Simple module activated!', context);
        // Add custom styling
        this.injectStyles(`
            .simple-module-banner {
                background: linear-gradient(45deg, #007bff, #6610f2);
                color: white;
                padding: 10px;
                border-radius: 5px;
                margin: 10px 0;
                text-align: center;
            }
        `);
    }
    
    async cleanup() {
        console.log('üßπ Simple module cleaned up!');
    }
    
    getContent() {
        return `
            &lt;div class="simple-module-banner"&gt;
                &lt;h3&gt;üéâ Simple Module Active!&lt;/h3&gt;
                &lt;p&gt;This module matches all URLs and shows custom content.&lt;/p&gt;
                &lt;button onclick="window.agentlet.utils.MessageBubble.success('Hello from Simple Module!')"&gt;
                    Say Hello
                &lt;/button&gt;
            &lt;/div&gt;
        `;
    }
}</code></pre>
                </div>
            </section>

            <section>
                <h2>2. Register the Module</h2>
                <div class="code-block">
                    <pre><code class="language-javascript">// Register the module with Agentlet
window.agentlet.modules.register(new SimpleModule());</code></pre>
                </div>
            </section>

            <section>
                <h2>3. Try It Out</h2>
                <div class="controls">
                    <button id="initializeBtn" class="btn btn-primary">
                        üöÄ Initialize Agentlet & Register Module
                    </button>
                    <button id="showModulesBtn" class="btn btn-secondary" disabled>
                        üì¶ Show Registered Modules
                    </button>
                    <button id="testEventsBtn" class="btn btn-secondary" disabled>
                        üì° Test Module Events
                    </button>
                </div>
            </section>

            <section>
                <h2>4. Module Lifecycle</h2>
                <div class="info-box">
                    <h4>Simplified 3-Hook Lifecycle:</h4>
                    <ol>
                        <li><strong>init()</strong> - Called once when module is first loaded</li>
                        <li><strong>activate(context)</strong> - Called when URL matches patterns</li>
                        <li><strong>cleanup(context)</strong> - Called when module is deactivated</li>
                    </ol>
                </div>
            </section>

            <section>
                <h2>API Reference</h2>
                <div class="api-reference">
                    <h4>Module Creation:</h4>
                    <code>class MyModule extends window.agentlet.Module</code>
                    
                    <h4>Module Registration:</h4>
                    <code>window.agentlet.modules.register(new MyModule())</code>
                    
                    <h4>Module Management:</h4>
                    <ul>
                        <li><code>window.agentlet.modules.get(name)</code> - Get module by name</li>
                        <li><code>window.agentlet.modules.getAll()</code> - Get all module names</li>
                        <li><code>window.agentlet.modules.unregister(name)</code> - Remove module</li>
                    </ul>
                </div>
            </section>
        </main>

        <aside class="console-panel">
            <div class="console-header">
                <h3>üìã Console & Status</h3>
            </div>
            <div id="console-output" class="console-output"></div>
            <div id="status-display" class="status-display">
                <div class="status-item">
                    <span class="status-label">Agentlet Status:</span>
                    <span id="agentlet-status" class="status-value">Not loaded</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Active Module:</span>
                    <span id="active-module" class="status-value">None</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Total Modules:</span>
                    <span id="total-modules" class="status-value">0</span>
                </div>
            </div>
        </aside>
    </div>

    <script>
        let agentletCore = null;

        // Custom console functions for this example's layout
        function log(message, type = 'info') {
            const consoleElement = document.getElementById('console-output');
            if (consoleElement) {
                const timestamp = new Date().toLocaleTimeString();
                const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
                consoleElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
                consoleElement.scrollTop = consoleElement.scrollHeight;
            }
        }

        function updateStatus(message, type = 'info') {
            // For this example, just show in console - the status elements are specific to this layout
            log(`Status: ${message}`, type);
        }

        // Load Agentlet script dynamically
        function loadAgentletScript() {
            return new Promise((resolve, reject) => {
                // Remove existing script if present
                const existingScript = document.querySelector('script[src*="agentlet-core.js"]');
                if (existingScript) {
                    existingScript.remove();
                }

                const script = document.createElement('script');
                script.src = '../../dist/agentlet-core.js?' + Date.now();

                script.onload = () => {
                    log('‚úÖ Agentlet Core script loaded successfully', 'success');
                    resolve();
                };

                script.onerror = () => {
                    const error = new Error('Failed to load Agentlet Core. Make sure you ran "npm run build" first.');
                    log('‚ùå Failed to load Agentlet Core script', 'error');
                    reject(error);
                };

                document.head.appendChild(script);
            });
        }

        // Initialize example
        document.getElementById('initializeBtn').onclick = async function() {
            try {
                log('üöÄ Loading Agentlet Core...');

                // Dynamically load Agentlet Core script
                await loadAgentletScript();

                // Access AgentletCore constructor
                let AgentletConstructor = null;
                if (window.AgentletCore) {
                    AgentletConstructor = window.AgentletCore.default;
                }

                if (!AgentletConstructor) {
                    throw new Error('AgentletCore constructor not found');
                }

                log('üöÄ Creating AgentletCore instance...');
                agentletCore = new AgentletConstructor({
                    debugMode: true,
                    startMinimized: false
                });

                log('‚öôÔ∏è Starting initialization...');
                await agentletCore.init();
                
                updateStatus('Agentlet Core loaded successfully', 'success');
                log('‚úÖ Agentlet Core initialized!', 'success');
                
                // Create and register the simple module
                class SimpleModule extends window.agentlet.Module {
                    constructor() {
                        super({
                            name: 'simple-demo',
                            patterns: ['*'],
                            description: 'A simple demonstration module'
                        });
                    }
                    
                    async init() {
                        log('‚úÖ Simple module initialized!', 'success');
                    }

                    async activate(context) {
                        log('üîÑ Simple module activated!', 'info');
                        updateStatus(`Active module: ${this.name}`, 'info');
                        
                        this.injectStyles(`
                            .simple-module-banner {
                                background: linear-gradient(45deg, #007bff, #6610f2);
                                color: white;
                                padding: 10px;
                                border-radius: 5px;
                                margin: 10px 0;
                                text-align: center;
                            }
                        `);
                    }
                    
                    async cleanup() {
                        log('üßπ Simple module cleaned up!', 'info');
                        updateStatus('Simple module cleaned up', 'info');
                    }
                    
                    getContent() {
                        return `
                            <div class="simple-module-banner">
                                <h3>üéâ Simple Module Active!</h3>
                                <p>This module matches all URLs and shows custom content.</p>
                                <button onclick="window.agentlet.utils.MessageBubble.success('Hello from Simple Module!')">
                                    Say Hello
                                </button>
                            </div>
                        `;
                    }
                }
                
                // Register the module
                window.agentlet.modules.register(new SimpleModule());

                const moduleCount = window.agentlet.modules.getAll().length;
                updateStatus(`${moduleCount} module(s) registered successfully`, 'success');
                log(`üì¶ Module registered: ${window.agentlet.modules.getAll()[0]}`, 'success');

                // Enable other buttons
                document.getElementById('showModulesBtn').disabled = false;
                document.getElementById('testEventsBtn').disabled = false;
                document.getElementById('initializeBtn').disabled = true;

            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                updateStatus(`Error: ${error.message}`, 'error');
                console.error(error);
            }
        };

        document.getElementById('showModulesBtn').onclick = function() {
            const modules = window.agentlet.modules.getAll();
            const activeModule = window.agentlet.moduleRegistry.activeModule;

            log(`üì¶ Registered modules: ${modules.length}`, 'info');
            modules.forEach(name => {
                const module = window.agentlet.modules.get(name);
                const isActive = activeModule && activeModule.name === name;
                log(`  ‚Ä¢ ${name} ${isActive ? '(ACTIVE)' : ''}`, 'info');
            });
            updateStatus(`Showing ${modules.length} registered modules`, 'info');
        };

        document.getElementById('testEventsBtn').onclick = function() {
            const module = window.agentlet.modules.get('simple-demo');
            if (module) {
                // Test module events
                module.emit('test-event', { message: 'Hello from event system!' });
                log('üì° Test event emitted', 'success');

                // Show module metadata
                const metadata = module.getMetadata();
                log('üìã Module metadata:', 'info');
                log(JSON.stringify(metadata, null, 2), 'info');
                updateStatus('Module events tested successfully', 'success');
            } else {
                log('‚ùå Module not found', 'error');
                updateStatus('Module not found', 'error');
            }
        };

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            log('üì¶ Simple Module example loaded', 'success');
            updateStatus('Ready for Agentlet initialization', 'info');
        });
    </script>
</body>
</html>